
Większość symulacji numerycznych wykonanych przez autora pracy, w szczególności symulacji metodą FDTD wymaga zastosowania komputerów dużej mocy~(ang HPC - High-performance computing). Zwiększenie mocy obliczeniowej przy wykorzystaniu takich zasobów wymaga zrównoleglenia obliczeń. Możliwe do uzyskania przyspieszenie w podstawowy sposób opisuje prawo Amdahla
\begin{equation}
	S=\frac{1}{(1-P)+\frac{P}{s}},
	\label{eq:amdahl}
\end{equation}
gdzie przez $S$ oznaczono całkowite przyspieszenie obliczeń, $P$ to część obliczeń która może zostać zrównoleglona, a $s$ to możliwe przyspieszenie części $P$ w wyniku zrównoleglenia. Przykładowe wartości przyspieszenia symulacji przy wykorzystaniu większej liczby rdzeni obliczeniowych prezentuje wykres na rysunku~\ref{fig:amdhal}.

\begin{figure}[h]
	\includegraphics[width=\textwidth]{images/amdahl.png}
	\caption{Możliwe przyspieszenie symulacji zgodnie z (\ref{eq:amdahl}), przy zerowym koszcie zrównoleglenia ($s$ równe liczbie używanych rdzeni) dla różnych wartości $P$~\cite{wiki:amdhal}}
	\label{fig:amdhal}
\end{figure}

W przypadku metod równoległego rozwiązywania równań różniczkowych, takich jak FDTD, zrównoleglenie wymaga wprowadzenia dodatkowego kroku zapewniającego uspójnienie warunków na częściach siatki stanowiących granicę między obszarami symulowanymi równolegle na różnych procesorach. Zrównoleglenie symulacji wymaga wykonania dodatkowego uspójnieniu warunków granicznych pomiędzy obszarami symulowanymi na różnych rdzeniach. Czas trwania tego dodatkowego kroku zależy przede wszystkim od opóźnień w komunikacji pomiędzy rdzeniami obliczeniowymi. Na całkowite opóźnienie składają się część aplikacyjna - zazwyczaj implementowana za pomocą protokołu MPI~(ang. message passing interface), oraz część sprzętowa. Obie te część należy w znaczącym stopniu dostosować do wykonywanej symulacji, o ile część aplikacyjna wymaga zastosowania odpowiednich parametrów blokowania~\footnote{Uspójniane warunki brzegowe w ramach jednego węzła mogą być np. przechwywane we współdzielonych przez procesy obszarach pamięci. W ten sposób obliczenia w sąsiednim obszarze są blokowane z uwzlędnieniem pojednyczych puntków siatki (mechanizm mutex systemu Linux), zamiast całych wektorów przesyłanych w komunikatach MPI.} oraz odciązania CPU z częśto wykorzystywanych operacji nie związanych bezpośrednio z prowadzoną symulacją~\footnote{Źle dobrana implementacja lub niewłaściwa konfiguracja mogą doprowadzić do znaczącego obciążenia procesora poprzez część aplikacji odpowiadającą za komunikację, np. liczenie sum kontrolnych dla pakietów TCP}. To część sprzętowa w znaczący sposób zależy od architektury połączeń między procesorami wewnątrz węzłów obliczeniowych, oraz właściwości sieci łączącej węzły obliczeniowe. 

Jądrem obliczeń numerycznych prowadzonych w niniejsze pracy była biblioteka meep~\cite{OskooiRo10} umożliwiająca wykonywanie obliczeń metodą FDTD.

Przed uruchomieniem symulacji należy oszacować wymagania co do pamięci RAM~(ang. random memory access). Dla symulacji FDTD z wykorzystaniem biblioteki meep możemy to zrobić obliczając liczbę węzłów siatki oraz mnożąc ją przez rozmiar używany do przechowywania liczb podwójnej precyzji, zazwyczaj jest to 8 bajtów. Jeżeli możliwe jest uruchomienie takiej symulacji na jednym węźle obliczeniowym~(jednym fizycznym serwerze) jest to najprostrzy sposób na uzyskanie optymalnej wydajności~\footnote{Sytuacja komplikuje się, gdy węzeł obliczeniowy posiada skomplikowaną wewnętrzną architektórę ccNUMA~(ang. cache coherent non-uniform memory access) jak np. platformy AMD z procesorami z rodziny Bulldozer obsługujące ponad 512GB pamięci RAM. Węzły tego typu często lepiej jest traktować logicznie jako kilka osobnych serwerów. W sposób szczególny należy również podchodzić do systemów wyposażonych w procesory Intel począwszy od architektury haswell, w których w zależności od modelu przepustowość do pamięci poszczególnych rdzeni CPU może być różna. Ze względu na specyfikę metody FDTD szybkośc obliczeń jest w największym stopniu związana z dostępem do pamięci RAM, dlatego warto rozważyć używanie na węźle jedynie kontrolerów pamięci i rdzeni charakteryzujących się taką samą przepustowością i czasem dostępu do pamięci RAM, pozostawiając część zasobów niewykorzystanych lub wykożystywanych przez inne symulacje.}. Decydując się na wykorzystanie większej liczby serwerów należy upewnić się, że środowisko, w którym uruchamiane są obliczenia zapewnia bezpośredni dostęp do pamięci innych węzłów~(ang. RDMA - remote direct memory access), jest to technologia znacznie zmniejszająca obciązenie procesora przez zadania systemu operacyjnego oraz skracająca czas synchronizacji nawet o rząd wielkości. Narzut na komunikację międzywęzłową zmniejsza $P$ w~\ref{eq:amdahl} w dużej mierze niezależnie od liczby użytych węzłów~\footnote{Jest to w szczególności prawdziwe dla powszechnie stosowanych nieblokujących topologii \textit{fat-tree} w sieciach infiniband~\cite{zahavi2010optimized}} w przypadku symulacji wielowęzłowych z wykorzystaniem meep możliwe jest przyspieszenie obliczeń symulacji do momentu zrównania czasu przeznaczonego na dostęp do pamięci z czasem poświęconym na obliczenia. W wyniku tej własności obserwować można większą skalowalność obliczeń metodą FDTD na procesorach w architektórze x86\_64, niż np. na procesorach typu Power7, ponieważ na każdy cykl procesora w przypadku x86\64 przypada ok. 0.3 dostępu do pamięci, a w przypadku Power7 jest to stosunek 1:1 (całkowity czas obliczeń jest jednak zazwyczaj krótszy w przypadku zasotosawnia superkomputerów Power775 pomimo użycia znacznie mniejszej liczby CPU). Innym skutkiem podanej właściwości jest możliwość dalszego skalowania symulacji w której znaczna część obszaru jest reprezentowana przez materiały dyspersyjne, których użycie znacznie zwiększa czas obliczeniowy ze względu na rozwiązywanie pomocniczego równania różniczkowego.

Powyżesze wskazówki mają na celu jedynie zasygnalizowanie szczegółów związanych z prowadzeniem symulacji na komputerach dużej mocy. Nie są one bezpośrednio związane z tematem niniejszej rozprawy, stanowiły jednak ważny element umożliwiający wykonanie analizowanych w pracy eksperymentów numerycznych.
